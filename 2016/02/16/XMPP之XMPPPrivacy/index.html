<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>XMPP之XMPPPrivacy | 雅玛氪星人</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="XMPPPrivacy简述 XMPP 开发者考虑到用户的隐私,他们已经定义了一个通讯阻止的扩展协议(定义在 Privacy Lists[XEP-0016]) ,和隐私列表的一个精简界面(定义在 Simple Communication Blocking[XEP-0191]中)。
XMPPPrivacy是什么？它不是什么？XMPPPrivacy就是是一种提供给xmpp开发者的的高级隐私策略方案 。他">
<meta property="og:type" content="article">
<meta property="og:title" content="XMPP之XMPPPrivacy">
<meta property="og:url" content="https://asuwill.github.io/2016/02/16/XMPP之XMPPPrivacy/index.html">
<meta property="og:site_name" content="雅玛氪星人">
<meta property="og:description" content="XMPPPrivacy简述 XMPP 开发者考虑到用户的隐私,他们已经定义了一个通讯阻止的扩展协议(定义在 Privacy Lists[XEP-0016]) ,和隐私列表的一个精简界面(定义在 Simple Communication Blocking[XEP-0191]中)。
XMPPPrivacy是什么？它不是什么？XMPPPrivacy就是是一种提供给xmpp开发者的的高级隐私策略方案 。他">
<meta property="og:updated_time" content="2016-02-16T08:34:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="XMPP之XMPPPrivacy">
<meta name="twitter:description" content="XMPPPrivacy简述 XMPP 开发者考虑到用户的隐私,他们已经定义了一个通讯阻止的扩展协议(定义在 Privacy Lists[XEP-0016]) ,和隐私列表的一个精简界面(定义在 Simple Communication Blocking[XEP-0191]中)。
XMPPPrivacy是什么？它不是什么？XMPPPrivacy就是是一种提供给xmpp开发者的的高级隐私策略方案 。他">
  
    <link rel="alternative" href="/atom.xml" title="雅玛氪星人" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">雅玛氪星人</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://asuwill.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-XMPP之XMPPPrivacy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/16/XMPP之XMPPPrivacy/" class="article-date">
  <time datetime="2016-02-16T06:04:11.000Z" itemprop="datePublished">2016-02-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      XMPP之XMPPPrivacy
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="XMPPPrivacy_u7B80_u8FF0"><a href="#XMPPPrivacy_u7B80_u8FF0" class="headerlink" title="XMPPPrivacy简述"></a>XMPPPrivacy简述</h6><p> XMPP 开发者考虑到用户的隐私,他们已经定义了一个通讯阻止的扩展协议(定义在 Privacy Lists[XEP-0016]) ,和隐私列表的一个精简界面(定义在 Simple Communication Blocking[XEP-0191]中)。</p>
<h6 id="XMPPPrivacy_u662F_u4EC0_u4E48_uFF1F_u5B83_u4E0D_u662F_u4EC0_u4E48_uFF1F"><a href="#XMPPPrivacy_u662F_u4EC0_u4E48_uFF1F_u5B83_u4E0D_u662F_u4EC0_u4E48_uFF1F" class="headerlink" title="XMPPPrivacy是什么？它不是什么？"></a>XMPPPrivacy是什么？它不是什么？</h6><p>XMPPPrivacy就是是一种提供给xmpp开发者的的高级隐私策略方案 。他不仅仅可以用于做黑名单，还可以做其他用户关系的表单</p>
<h6 id="XMPPPrivacy__u548C_u5176_u4ED6_u6982_u5FF5_u6709_u4EC0_u4E48_u533A_u522B_uFF1F"><a href="#XMPPPrivacy__u548C_u5176_u4ED6_u6982_u5FF5_u6709_u4EC0_u4E48_u533A_u522B_uFF1F" class="headerlink" title="XMPPPrivacy 和其他概念有什么区别？"></a>XMPPPrivacy 和其他概念有什么区别？</h6><p>(1).XMPPPrivacy 与 黑名单功能的区别？（待续）<br>(2).XMPPPrivacy与XMPPBlocking（待续）</p>
<p>XMPPPrivacy 与 XMPPBlocking的区别</p>
<h6 id="XMPPPrivacy_u600E_u6837_u6B63_u786E_u4F7F_u7528_uFF1F"><a href="#XMPPPrivacy_u600E_u6837_u6B63_u786E_u4F7F_u7528_uFF1F" class="headerlink" title="XMPPPrivacy怎样正确使用？"></a>XMPPPrivacy怎样正确使用？</h6><blockquote>
<p>步骤1. 激活隐私功能   </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_xmppPrivacy = [[XMPPPrivacy alloc] initWithDispatchQueue:self.moduleQueue];&#10;_xmppPrivacy.autoRetrievePrivacyListItems = NO;&#10;_xmppPrivacy.autoRetrievePrivacyListNames = NO;&#10;[_xmppPrivacy activate:self.xmppStream];&#10;[_xmppPrivacy addDelegate:self delegateQueue:self.moduleQueue];</span><br></pre></td></tr></table></figure>
<p>步骤2. 获取服务端隐私列表<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[_xmppPrivacy retrieveListNames];//&#33719;&#21462;&#38544;&#31169;&#21015;&#34920;&#21517;&#21333;   &#10;[_xmppPrivacy retrieveListWithName:CONTACT_BLACK_LIST];//&#33719;&#21462;&#38544;&#31169;&#21015;&#34920;&#20013;&#21517;&#31216;&#20026;CONTACT_BLACK_LIST&#20013;&#30340;&#25968;&#25454;&#10;```   &#10;&#10;&#62; &#27493;&#39588;3. &#28155;&#21152;&#32852;&#31995;&#20154;&#21040;&#40657;&#21517;&#21333;    &#10;&#62; ```objective-c&#10;  - (void)blockContact:(ContactModel *)contact &#123;&#10;    if (!contact || !contact.jid) &#123;&#10;        Error *error = [Error errorWithCode:ErrorTypeContactInfoMissing&#10;                                 andDescription:@&#34;contact info missing&#65281;&#34;];&#10;        [multicastDelegate didBlockBuddy:contact.username&#10;                                   error:error];&#10;        return;&#10;      &#125;&#10;      [self asyncTask:^&#123;&#10;        NSMutableArray *arrayPrivacy = [NSMutableArray array];&#10;        //add original blocked contact&#10;        _tmpBlockedContacts = [NSMutableDictionary dictionary];&#125;];&#10;         for (ContactModel *blackContact in [_blockedContacts allValues]) &#123;&#10;         NSXMLElement *privacyElement = [XMPPPrivacy privacyItemWithType:@&#34;jid&#34;&#10;                                                                   value:blackContact.jid&#10;                                                                  action:@&#34;deny&#34;&#10;                                                                   order:CONTACT_BLACK_LIST_ORDER];&#10;            [XMPPPrivacy blockIQs:privacyElement];&#10;            [XMPPPrivacy blockMessages:privacyElement];&#10;            [XMPPPrivacy blockPresenceIn:privacyElement];&#10;            [XMPPPrivacy blockPresenceOut:privacyElement];&#10;            [arrayPrivacy addObject:privacyElement];&#10;            [_tmpBlockedContacts setObject:blackContact forKey:blackContact.username];&#125;&#10;        //add new blocked conatct&#10;        NSXMLElement *privacyElement = [XMPPPrivacy privacyItemWithType:@&#34;jid&#34;&#10;                                                                  value:contact.jid&#10;                                                                 action:@&#34;deny&#34;&#10;                                                                  order:CONTACT_BLACK_LIST_ORDER];&#10;        [XMPPPrivacy blockIQs:privacyElement];&#10;        [XMPPPrivacy blockMessages:privacyElement];&#10;        [XMPPPrivacy blockPresenceIn:privacyElement];&#10;        [XMPPPrivacy blockPresenceOut:privacyElement];&#10;        [arrayPrivacy addObject:privacyElement];&#10;        [_tmpBlockedContacts setValue:contact forKey:contact.username];&#10;        [_xmppPrivacy setListWithName:CONTACT_BLACK_LIST items:arrayPrivacy];&#10;  &#125;</span><br></pre></td></tr></table></figure></p>
<p>步骤4. 将联系人从黑名单移除<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)unblockContact:(ContactModel *)contact &#123;&#10;  if (!contact || !contact.jid) &#123;&#10;      Error *error = [Error errorWithCode:ErrorTypeContactInfoMissing&#10;                               andDescription:@&#34;contact info missing&#65281;&#34;];&#10;      [multicastDelegate didUnblockBuddy:contact.username&#10;                                   error:error];&#10;      return;&#10;    &#125;&#10;    [self asyncTask:^&#123;&#10;    _tmpBlockedContacts = [NSMutableDictionary dictionary];&#10;    NSMutableArray *arrayPrivacy = [NSMutableArray array];&#10;        for (ContactModel *blackContact in [_blockedContacts allValues]) &#123;&#10;        if ([blackContact isEqual:contact]) &#123;&#10;               continue;&#10;        &#125;&#10;        NSXMLElement *privacyElement = [XMPPPrivacy privacyItemWithType:@&#34;jid&#34;&#10;                                                                      value:blackContact.jid&#10;                                                                     action:@&#34;deny&#34;&#10;                                                                      order:CONTACT_BLACK_LIST_ORDER];&#10;            [XMPPPrivacy blockIQs:privacyElement];&#10;            [XMPPPrivacy blockMessages:privacyElement];&#10;            [XMPPPrivacy blockPresenceIn:privacyElement];&#10;            [XMPPPrivacy blockPresenceOut:privacyElement];&#10;            [arrayPrivacy addObject:privacyElement];&#10;            [_tmpBlockedContacts setObject:blackContact forKey:blackContact.username];&#10;      &#125;&#10;        [_xmppPrivacy setListWithName:CONTACT_BLACK_LIST items:arrayPrivacy];&#10;  &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>步骤5. 监控回调数据<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#33719;&#21462;&#21040;&#38544;&#31169;&#33756;&#21333;&#21517;&#31216;&#21015;&#34920;&#22238;&#35843;&#10;- (void)xmppPrivacy:(XMPPPrivacy *)sender didReceiveListNames:(NSArray *)listNames &#123;&#10;    if (![_xmppPrivacy.activeListName isEqualToString:CONTACT_BLACK_LIST]) &#123;&#10;        [_xmppPrivacy setActiveListName:CONTACT_BLACK_LIST];&#10;    &#125;&#10;&#125;&#10;//&#33719;&#21462;&#21040;&#38544;&#31169;&#33756;&#21333;&#21517;&#31216;&#21015;&#34920;&#22833;&#36133;&#22238;&#35843;&#10;- (void)xmppPrivacy:(XMPPPrivacy *)sender didNotReceiveListNamesDueToError:(id)error &#123;&#10;    if (![_xmppPrivacy.activeListName isEqualToString:CONTACT_BLACK_LIST]) &#123;&#10;        [_xmppPrivacy setActiveListName:CONTACT_BLACK_LIST];&#10;    &#125;&#10;&#125;&#10;- (void)xmppPrivacy:(XMPPPrivacy *)sender didReceiveListWithName:(NSString *)name items:(NSArray *)items &#123;&#10;    if (items &#60;= 0) &#123;&#10;        [_blockedContacts removeAllObjects];&#10;        [multicastDelegate didUpdateBlockedList:[_blockedContacts allValues]];&#10;        return;&#10;    &#125;&#10;    for (DDXMLElement *blockItem in items) &#123;&#10;        NSString *fullJid = [blockItem attributeStringValueForName:@&#34;value&#34;];&#10;        ContactModel *contact = [[ContactModel alloc] initWithJid:[XMPPJID jidWithString:fullJid]];&#10;        [_blockedContacts setObject:contact forKey:contact.username];&#10;    &#125;&#10;    [multicastDelegate didUpdateBlockedList:[_blockedContacts allValues]];//3&#10;&#125;&#10;- (void)xmppPrivacy:(XMPPPrivacy *)sender didReceivePushWithListName:(NSString *)name &#123;&#10;    [_xmppPrivacy setActiveListName:name];&#10;&#125;&#10;//&#37325;&#26032;&#35774;&#32622;&#21517;&#31216;&#20026;name&#30340;&#21015;&#34920;&#21518;&#22238;&#35843;&#10;- (void)xmppPrivacy:(XMPPPrivacy *)sender didSetListWithName:(NSString *)name &#123;&#10;    _blockedContacts = _tmpBlockedContacts;&#10;    _tmpBlockedContacts = nil;&#10;    [multicastDelegate didUpdateBlockedList:[_blockedContacts allValues]];//2&#10;&#125;&#10;- (void)xmppPrivacy:(XMPPPrivacy *)sender didNotSetListWithName:(NSString *)name error:(id)error &#123;&#10;    Error *blockError = [Error errorWithCode:ErrorTypeBlockContactFailed&#10;                                  andDescription:[error description]];&#10;    if ([_blockedContacts count] &#62; [_tmpBlockedContacts count]) &#123;&#10;        [multicastDelegate didUnblockBuddy:nil error:blockError];&#10;    &#125;else &#123;&#10;        [multicastDelegate didBlockBuddy:nil error:blockError];&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h6 id="XMPPPrivacy_u4F7F_u7528_u7684_u65F6_u5019_u5E94_u8BE5_u6CE8_u610F_u4EC0_u4E48_uFF1F"><a href="#XMPPPrivacy_u4F7F_u7528_u7684_u65F6_u5019_u5E94_u8BE5_u6CE8_u610F_u4EC0_u4E48_uFF1F" class="headerlink" title="XMPPPrivacy使用的时候应该注意什么？"></a>XMPPPrivacy使用的时候应该注意什么？</h6><p>每次添加联系人到某个表单或从某个表单移除一个联系人都需要将这个表单重新设置一遍。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://asuwill.github.io/2016/02/16/XMPP之XMPPPrivacy/" data-id="cikp5oe0m0002wabrer9m3wx8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XMPP/">XMPP</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/02/16/NSURLSession理解/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">NSURLSession理解</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/XMPP/">XMPP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/XMPP/" style="font-size: 10px;">XMPP</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/02/16/XMPP之XMPPPrivacy/">XMPP之XMPPPrivacy</a>
          </li>
        
          <li>
            <a href="/2016/02/16/NSURLSession理解/">NSURLSession理解</a>
          </li>
        
          <li>
            <a href="/2016/02/15/NSURLSessionConfiguration学习/">NSURLSessionConfiguration学习</a>
          </li>
        
          <li>
            <a href="/2016/02/15/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Haswill<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>